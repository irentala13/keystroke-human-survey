<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text Keystroke Analysis Survey</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  
  <!-- Load email config FIRST - blocking script in head to ensure it loads before any other scripts -->
  <script src="config.js"></script>
  <script>
    // Verify config.js loaded immediately (this runs synchronously after config.js)
    // Also ensure EMAIL_CONFIG_OVERRIDE is globally accessible
    (function() {
      try {
        // Check if config.js defined the variable
        if (typeof EMAIL_CONFIG_OVERRIDE !== 'undefined' && EMAIL_CONFIG_OVERRIDE) {
          // Ensure it's globally accessible via window object
          window.EMAIL_CONFIG_OVERRIDE = EMAIL_CONFIG_OVERRIDE;
          
          console.log('‚úÖ config.js loaded successfully');
          console.log('‚úÖ EMAIL_CONFIG_OVERRIDE is defined and accessible');
          console.log('EmailJS config check:', {
            SERVICE_ID: EMAIL_CONFIG_OVERRIDE.SERVICE_ID ? '***' + EMAIL_CONFIG_OVERRIDE.SERVICE_ID.slice(-4) : 'missing',
            TEMPLATE_ID: EMAIL_CONFIG_OVERRIDE.TEMPLATE_ID ? '***' + EMAIL_CONFIG_OVERRIDE.TEMPLATE_ID.slice(-4) : 'missing',
            USER_ID: EMAIL_CONFIG_OVERRIDE.USER_ID ? '***' + EMAIL_CONFIG_OVERRIDE.USER_ID.slice(-4) : 'missing',
            TO_EMAIL: EMAIL_CONFIG_OVERRIDE.TO_EMAIL ? EMAIL_CONFIG_OVERRIDE.TO_EMAIL.replace(/(.{2})(.*)(@.*)/, '$1***$3') : 'missing',
            hasAllFields: !!(EMAIL_CONFIG_OVERRIDE.SERVICE_ID && EMAIL_CONFIG_OVERRIDE.TEMPLATE_ID && EMAIL_CONFIG_OVERRIDE.USER_ID && EMAIL_CONFIG_OVERRIDE.TO_EMAIL)
          });
        } else {
          
          // Try to fetch config.js manually as a fallback
          console.log('üîÑ Attempting to fetch config.js manually...');
          fetch('config.js')
            .then(response => {
              if (!response.ok) {
                console.error('‚ùå config.js fetch failed:', response.status, response.statusText);
                return null;
              }
              return response.text();
            })
            .then(text => {
              if (text) {
                console.log('‚úÖ Successfully fetched config.js content');
                console.log('   First 200 chars:', text.substring(0, 200));
                // Try to eval it
                try {
                  eval(text);
                  if (typeof EMAIL_CONFIG_OVERRIDE !== 'undefined') {
                    window.EMAIL_CONFIG_OVERRIDE = EMAIL_CONFIG_OVERRIDE;
                    console.log('‚úÖ Successfully evaluated config.js - EMAIL_CONFIG_OVERRIDE now available');
                  }
                } catch (e) {
                  console.error('‚ùå Error evaluating config.js:', e);
                }
              }
            })
            .catch(err => {
              console.error('‚ùå Failed to fetch config.js:', err);
            });
        }
      } catch (e) {
        console.error('‚ùå Error checking EMAIL_CONFIG_OVERRIDE:', e);
      }
    })();
  </script>
  
  <!-- Load external libraries -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/addons/p5.sound.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chroma-js@2.4.2/chroma.min.js"></script>
</head>
<body>
  <main></main>
  
  <!-- Load main survey script -->
  <script src="text-keystroke-analysis-survey-from-json.js"></script>
  <script src="survey_data_from_json.js"></script>
  <script>
    // Helper function for email copy functionality (if needed)
    function copyEmailSafely(event) {
      event.preventDefault();
      const email = 'fpd1social@gmail.com';
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(email).then(() => {
          console.log('Email copied to clipboard');
        }).catch(err => {
          console.error('Failed to copy email:', err);
        });
      } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = email;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          console.log('Email copied to clipboard');
        } catch (err) {
          console.error('Failed to copy email:', err);
        }
        document.body.removeChild(textArea);
      }
    }
    
    // Override the problematic onclick handler after the main script loads
    document.addEventListener('DOMContentLoaded', function() {
      // Wait a bit for the email element to be created
      setTimeout(() => {
        const emailElement = document.getElementById('email-copy-button');
        if (emailElement) {
          emailElement.onclick = copyEmailSafely;
        }
      }, 1000);
    });
  </script>
</body>
</html>
